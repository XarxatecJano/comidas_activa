
> appcomidassemana@1.0.0 test
> jest tests/shopping-list-calculation.test.ts

  console.log
    [dotenv@17.2.3] injecting env (5) from .env -- tip: ⚙️  override existing env vars with { override: true }

      at _log (node_modules/dotenv/lib/main.js:142:11)

  console.log
    ✓ New client connected to PostgreSQL database

      at BoundPool.<anonymous> (src/config/database.ts:17:11)

  console.log
    DEBUG: createMenuPlan bulk IDs: {
      lunch: [ '6762cd08-9bc6-429a-87a2-e8d3e402785a' ],
      dinner: [
        '6762cd08-9bc6-429a-87a2-e8d3e402785a',
        '84c01644-ae96-4f4e-bbc7-1c7a1b45f24b'
      ]
    }

      at MenuPlanService.createMenuPlan (src/services/MenuPlanService.ts:52:13)

  console.log
    DEBUG: Creating bulk diners for meal: cd9b6556-0719-47a3-8bd2-a81e3f65e416 [ '6762cd08-9bc6-429a-87a2-e8d3e402785a' ]

      at MenuPlanService.createMealFromGenerated (src/services/MenuPlanService.ts:366:15)

  console.log
    DEBUG: Creating bulk diners for meal: 0a391c8c-de44-4734-a642-67daad7985a4 [
      '6762cd08-9bc6-429a-87a2-e8d3e402785a',
      '84c01644-ae96-4f4e-bbc7-1c7a1b45f24b'
    ]

      at MenuPlanService.createMealFromGenerated (src/services/MenuPlanService.ts:366:15)

  console.log
    ✓ New client connected to PostgreSQL database

      at BoundPool.<anonymous> (src/config/database.ts:17:11)

  console.log
    ✓ New client connected to PostgreSQL database

      at BoundPool.<anonymous> (src/config/database.ts:17:11)

  console.log
    DEBUG: createMenuPlan bulk IDs: {
      lunch: [ '34e3cb2c-9c1c-4100-9205-ccb22fd34a65' ],
      dinner: [
        '34e3cb2c-9c1c-4100-9205-ccb22fd34a65',
        '97d974a6-bbf8-4d5a-9aa7-dc5826b4952d'
      ]
    }

      at MenuPlanService.createMenuPlan (src/services/MenuPlanService.ts:52:13)

  console.log
    DEBUG: Creating bulk diners for meal: c8309f7c-1978-486b-a5bb-b6f9d4867d72 [ '34e3cb2c-9c1c-4100-9205-ccb22fd34a65' ]

      at MenuPlanService.createMealFromGenerated (src/services/MenuPlanService.ts:366:15)

FAIL tests/shopping-list-calculation.test.ts (16.61 s)
  Shopping List Calculation with Bulk Diners
    ✕ should correctly resolve diners for shopping list generation (5306 ms)
    ✕ should reflect updated preferences in shopping list (dynamic resolution) (2648 ms)

  ● Shopping List Calculation with Bulk Diners › should correctly resolve diners for shopping list generation

    thrown: "Exceeded timeout of 5000 ms for a test.
    Add a timeout value to this test to increase the timeout, if this is a long-running test. See https://jestjs.io/docs/api#testname-fn-timeout."

      46 |     });
      47 |
    > 48 |     it('should correctly resolve diners for shopping list generation', async () => {
         |       ^
      49 |         // Create menu plan
      50 |         let menuPlan;
      51 |         try {

      at tests/shopping-list-calculation.test.ts:48:7
      at Object.<anonymous> (tests/shopping-list-calculation.test.ts:6:9)

  ● Shopping List Calculation with Bulk Diners › should reflect updated preferences in shopping list (dynamic resolution)

    expect(received).toHaveLength(expected)

    Matcher error: received value must have a length property whose value must be a number

    Received has value: undefined

      120 |
      121 |         // This expectation will fail if we use snapshot, pass if we use dynamic
    > 122 |         expect(lunchMeal?.diners).toHaveLength(2);
          |                                   ^
      123 |         expect(lunchMeal?.diners.map(d => d.name)).toContain('Member 2');
      124 |     });
      125 | });

      at Object.<anonymous> (tests/shopping-list-calculation.test.ts:122:35)

Test Suites: 1 failed, 1 total
Tests:       2 failed, 2 total
Snapshots:   0 total
Time:        18.149 s
Ran all test suites matching /tests\/shopping-list-calculation.test.ts/i.

  ●  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "Client removed from pool".

      25 | // Evento de eliminación de cliente
      26 | pool.on('remove', (client) => {
    > 27 |   console.log('Client removed from pool');
         |           ^
      28 | });
      29 |
      30 | // Función para verificar la conexión

      at console.log (node_modules/@jest/console/build/CustomConsole.js:141:10)
      at BoundPool.<anonymous> (src/config/database.ts:27:11)
      at Connection.<anonymous> (node_modules/pg-pool/index.js:174:15)
      at Socket.<anonymous> (node_modules/pg/lib/connection.js:62:12)


  ●  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "Client removed from pool".

      25 | // Evento de eliminación de cliente
      26 | pool.on('remove', (client) => {
    > 27 |   console.log('Client removed from pool');
         |           ^
      28 | });
      29 |
      30 | // Función para verificar la conexión

      at console.log (node_modules/@jest/console/build/CustomConsole.js:141:10)
      at BoundPool.<anonymous> (src/config/database.ts:27:11)
      at Connection.<anonymous> (node_modules/pg-pool/index.js:174:15)
      at Socket.<anonymous> (node_modules/pg/lib/connection.js:62:12)


  ●  Cannot log after tests are done. Did you forget to wait for something async in your test?
    Attempted to log "Client removed from pool".

      25 | // Evento de eliminación de cliente
      26 | pool.on('remove', (client) => {
    > 27 |   console.log('Client removed from pool');
         |           ^
      28 | });
      29 |
      30 | // Función para verificar la conexión

      at console.log (node_modules/@jest/console/build/CustomConsole.js:141:10)
      at BoundPool.<anonymous> (src/config/database.ts:27:11)
      at Connection.<anonymous> (node_modules/pg-pool/index.js:174:15)
      at Socket.<anonymous> (node_modules/pg/lib/connection.js:62:12)

